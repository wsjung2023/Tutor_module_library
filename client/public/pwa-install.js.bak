// PWA ì„¤ì¹˜ ë°°ë„ˆ (ì •ì„ ë°©ë²•)
let deferredPrompt = null;

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e; // ì €ì¥
  
  // ì„¤ì¹˜ ë°°ë„ˆ í‘œì‹œ
  showInstallBanner();
});

function showInstallBanner() {
  if (!deferredPrompt) return;
  
  const banner = document.createElement('div');
  banner.id = 'pwa-install-banner';
  banner.style.cssText = `
    position: fixed;
    bottom: 20px;
    left: 20px;
    right: 20px;
    max-width: 400px;
    margin: 0 auto;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 16px;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  `;
  
  banner.innerHTML = `
    <div style="display: flex; align-items: center; gap: 12px;">
      <div style="font-size: 24px;">ğŸ“±</div>
      <div>
        <div style="font-weight: 600; font-size: 14px;">ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ê¸°</div>
        <div style="font-size: 12px; opacity: 0.9;">í™ˆ í™”ë©´ì— ì¶”ê°€í•˜ì—¬ ë¹ ë¥´ê²Œ ì ‘ê·¼í•˜ì„¸ìš”</div>
      </div>
    </div>
    <div style="display: flex; gap: 8px;">
      <button id="pwa-install-btn" style="
        background: rgba(255,255,255,0.2);
        border: none;
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 12px;
        cursor: pointer;
        font-weight: 500;
      ">ì„¤ì¹˜</button>
      <button id="pwa-close-btn" style="
        background: transparent;
        border: none;
        color: white;
        padding: 8px;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        opacity: 0.7;
      ">âœ•</button>
    </div>
  `;
  
  document.body.appendChild(banner);
  
  // "ì•± ì„¤ì¹˜" ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬
  document.getElementById('pwa-install-btn').addEventListener('click', async () => {
    if (!deferredPrompt) return;
    
    deferredPrompt.prompt();
    const result = await deferredPrompt.userChoice;
    
    if (result.outcome === 'accepted') {
      console.log('PWA ì„¤ì¹˜ë¨');
    } else {
      console.log('PWA ì„¤ì¹˜ ì·¨ì†Œë¨');
    }
    
    deferredPrompt = null;
    banner.remove();
  });
  
  // ë‹«ê¸° ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬
  document.getElementById('pwa-close-btn').addEventListener('click', () => {
    banner.remove();
    deferredPrompt = null;
  });
}

// ì´ë¯¸ ì„¤ì¹˜ëœ ê²½ìš° ì²´í¬
window.addEventListener('appinstalled', () => {
  console.log('PWAê°€ ì„±ê³µì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤');
  const banner = document.getElementById('pwa-install-banner');
  if (banner) banner.remove();
});