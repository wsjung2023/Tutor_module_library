// PWA 설치 배너 (정석 방법)
let deferredPrompt = null;

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e; // 저장
  
  // 설치 배너 표시
  showInstallBanner();
});

function showInstallBanner() {
  if (!deferredPrompt) return;
  
  const banner = document.createElement('div');
  banner.id = 'pwa-install-banner';
  banner.style.cssText = `
    position: fixed;
    bottom: 20px;
    left: 20px;
    right: 20px;
    max-width: 400px;
    margin: 0 auto;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 16px;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  `;
  
  banner.innerHTML = `
    <div style="display: flex; align-items: center; gap: 12px;">
      <div style="font-size: 24px;">📱</div>
      <div>
        <div style="font-weight: 600; font-size: 14px;">앱으로 설치하기</div>
        <div style="font-size: 12px; opacity: 0.9;">홈 화면에 추가하여 빠르게 접근하세요</div>
      </div>
    </div>
    <div style="display: flex; gap: 8px;">
      <button id="pwa-install-btn" style="
        background: rgba(255,255,255,0.2);
        border: none;
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 12px;
        cursor: pointer;
        font-weight: 500;
      ">설치</button>
      <button id="pwa-close-btn" style="
        background: transparent;
        border: none;
        color: white;
        padding: 8px;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        opacity: 0.7;
      ">✕</button>
    </div>
  `;
  
  document.body.appendChild(banner);
  
  // "앱 설치" 버튼 클릭 핸들러
  document.getElementById('pwa-install-btn').addEventListener('click', async () => {
    if (!deferredPrompt) return;
    
    deferredPrompt.prompt();
    const result = await deferredPrompt.userChoice;
    
    if (result.outcome === 'accepted') {
      console.log('PWA 설치됨');
    } else {
      console.log('PWA 설치 취소됨');
    }
    
    deferredPrompt = null;
    banner.remove();
  });
  
  // 닫기 버튼 클릭 핸들러
  document.getElementById('pwa-close-btn').addEventListener('click', () => {
    banner.remove();
    deferredPrompt = null;
  });
}

// 이미 설치된 경우 체크
window.addEventListener('appinstalled', () => {
  console.log('PWA가 성공적으로 설치되었습니다');
  const banner = document.getElementById('pwa-install-banner');
  if (banner) banner.remove();
});